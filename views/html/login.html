<!DOCTYPE HTML>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <title>Inbox</title>
    <meta name="application-name" content="Msgboy"/>
    <link rel="shortcut icon" href="http://superfeedr.com/favicon.ico">
    <link rel="stylesheet" href="../css/style.css" />

    <!-- Lib includes -->
    <script src="../../lib/jquery/jquery.js" type="text/javascript"></script> 
    <script src="../../lib/date.extensions.js" type="text/javascript"></script> 
    <script src="../../lib/underscore/underscore-min.js" type="text/javascript"></script> 
    <script src="../../lib/backbone/backbone-min.js" type="text/javascript"></script> 
    <script src="../../lib/backbone-indexeddb/backbone-indexeddb.js" type="text/javascript"></script> 

    <!-- Model includes -->
    <script src="../../models/database.js" type="text/javascript"></script> 
    <script src="../../models/message.js" type="text/javascript"></script> 
    <script src="../../models/archive.js" type="text/javascript"></script> 
    <script src="../../models/inbox.js" type="text/javascript"></script> 

    <!-- Controller includes -->
    <script src="../../controllers/utils.js" type="text/javascript"></script> 
</head>
<body>
    <h1>Login</h1>

    <form accept-charset="UTF-8" id="new_session">

        <div class="field"> 
            <label for="user_username">Username</label><br /> 
            <input id="user_username" name="user[username]" size="30" type="text" /> 
        </div> 
        <div class="field"> 
            <label for="user_password">Password</label><br /> 
            <input id="user_password" name="user[password]" size="30" type="password" value="" /> 
        </div> 

        <div class="actions"> 
            <input id="user_submit" name="commit" type="submit" value="Log in" /> &nbsp; <a href="http://msgboy.com/passwords/new">Forgot password?</a>
        </div> 
    </form>

    <script>
    var base = "http://msgboy.com"

    var NewUserFormView = Backbone.View.extend({
        events: {
            "submit": "login",
        },

        initialize: function() {
            _.bindAll(this, "render");
        },

        render: function() {
        },

        login: function() {
            chrome.extension.sendRequest({
                "settings": {
                    "set": ["jid", $("#user_username").val()]
                }
            }, function (response) {
                chrome.extension.sendRequest({
                    "settings": {
                        "set": ["password", $("#user_password").val()]
                    }
                }, function (response) {
                    // Now we need to tell the msgboy to connect and then redirect to options!
                    chrome.extension.sendRequest({
                        connect: true
                    }, function (response) {
                        window.location = chrome.extension.getURL('/views/html/options.html')
                    }.bind(this));
                }.bind(this));
            }.bind(this));
            return false
        }
        
    });

    var view = new NewUserFormView({
        el: "#new_session"
    });
    
    </script>
</body>
</html>

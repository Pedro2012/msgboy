<!DOCTYPE HTML>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <title>Inbox</title>
    <meta name="application-name" content="Growme"/>
    <meta name="description" content="__MSG_app_description__"/>
    <link rel="shortcut icon" href="http://superfeedr.com/favicon.ico">
    <link rel="stylesheet" href="../css/notification.css" />


    <!-- Lib includes -->
    <script src="../../lib/jquery/jquery-1.5.1.min.js" type="text/javascript"></script> 
    <script src="../../lib/underscore/underscore-min.js" type="text/javascript"></script> 
    <script src="../../lib/backbone/backbone-min.js" type="text/javascript"></script> 
    <script src="../../lib/backbone-localstorage/backbone-localstorage.js" type="text/javascript"></script> 

    <!-- Model includes -->
    <script src="../../models/message.js" type="text/javascript"></script> 
    <script src="../../models/archive.js" type="text/javascript"></script> 
    <script src="../../models/inbox.js" type="text/javascript"></script> 
    <script src="../../models/subscription.js" type="text/javascript"></script> 

    <!-- Controller includes -->
    <script src="../../controllers/utils.js" type="text/javascript"></script> 

</head>
<body>
    <div id="message">
    </div>
    <!-- Templates -->
    <script type="text/template" id="notification-template">
            <h1><%= truncate(title , 42)%></h1>
            <p>
            <% if(source) {
                %>
                <span><%= source.title %></span>&nbspâ€”&nbsp
                <%
            } %>
            <%= truncate(strip(summary), 96)%> </p>
    </script>
    
    <script>
    
    $(document).ready(function() {
		window.focus();
        var message = new Message({id: getParameterByName("message")})
        message.fetch();
        var MessageView = Backbone.View.extend({
            initialize: function() {
                _.bindAll(this, "render", "openViewer");
                $('body').click(this.openViewer);
            },
            
            render: function() {
                $(this.el).html(_.template($('#notification-template').html(), this.model.toJSON()));
                return this;
            },
            
            openViewer: function() {
                chrome.tabs.create({url:this.model.toJSON().links.alternate["text/html"][0].href, selected: false});
                window.close();
            }
        });
        
        view = new MessageView({model: message, el: "#message"});
        view.render();
        
        setTimeout(function() {
            window.close();
        }, 5000);
        
    });
    </script>
</body>